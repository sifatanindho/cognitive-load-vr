<!DOCTYPE html>
<html>
<head>
    <title>Waiting to Start Experiment</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        function checkAllReady() {
            $.ajax({
                url: "/check_all_ready_for_experiment",
                type: "GET",
                dataType: "json",
                success: function(data) {
                    $("#ready-count").text(data.ready_count);
                    $("#total-count").text(data.total_count);
                    const percentage = (data.ready_count / data.total_count) * 100;
                    $("#progress-bar").css("width", percentage + "%");
                    if (data.all_ready) {
                        window.location.href = "/experiment";
                    } else {
                        setTimeout(checkAllReady, 1000);
                    }
                },
                error: function() {
                    setTimeout(checkAllReady, 3000);
                }
            });
        }
        $(document).ready(function() {
            setTimeout(checkAllReady, 1000);
        });
    </script>
</head>
<body class="bg-gray-100 flex flex-col items-center justify-center min-h-screen space-y-6">
    <div class="bg-white p-8 rounded shadow-md text-center space-y-6 max-w-md">
        <h1 class="text-2xl font-bold">Waiting to Start Experiment</h1>
        <div class="text-lg">
            <p>Task {{ task_number }} will begin when all participants are ready.</p>
            <p class="mt-4">
                <span id="ready-count">{{ ready_count }}</span>/<span id="total-count">{{ total_count }}</span> participants are ready to start
            </p>
        </div>
        <div class="w-full bg-gray-200 rounded-full h-4">
            <div id="progress-bar" class="bg-green-600 h-4 rounded-full transition-all duration-500 ease-in-out" style="width: {{ (ready_count / total_count) * 100 }}%"></div>
        </div>
        <p class="text-gray-500">Please wait while other participants prepare to start...</p>
    </div>
</body>
</html>